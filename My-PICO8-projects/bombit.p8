pico-8 cartridge // http://www.pico-8.com
version 38
__lua__

current_selection = 1

function _init()
  cls()
  current_state_init(current_selection)
end

function _update()

		current_state_update(current_selection)
		if player != nil then
				player:update()
		end
end

function _draw()
  
  cls()  -- clear screen every frame (optional if static)
  current_state_draw(current_selection)
 	--if (waiting) then
 		
end

-->8
-- player
timer = 0
waiting = false

player = {	
		x = 136,
		y = 8,
		spr_id = 1,
		
		update = function (self)
			if self.spr_id > 3 then
				self.spr_id = 1
			end
			
			if not waiting and btnp(5) then  
    waiting = true
    timer = 0
    bomb.x = player.x
    bomb.y = player.y
    end

   if waiting then
      timer += 1
      if timer >= 60 then 
            bomb:deploy()
            waiting = false
      end
    end
		end,
		
		moves = function(self)
			lx = self.x
			ly = self.y
			if btn(➡️) then 
				self.x += 1
				self.spr_id += 1
			elseif btn(⬅️) then
				self.x -= 1
				self.spr_id += 1
			elseif btn(⬆️) then
				self.y -= 1
				self.spr_id += 1
			elseif btn(⬇️) then
				self.y += 1
				self.spr_id += 1
			end
			
			if collide(self) then
				self.x = lx
				self.y = ly
			end
		end
}
	


-->8
-- title screen

colour = 0
y = 0

startup = {
-- map
-- sound
-- update
-- draw




update = function(self)
	-- do animation
	colour += 1
	y = 85 + sin (time() * 2) * 5
	
	-- if z is pressed destroy title screen
	if btn(4) then
		current_selection += 1
	end
end,

init = function(self)
	cls()
end,

draw = function(self)
	cls()
	map()
	print ("press 'z' to start" , 25, y, colour)
end,

destroy = function(self)
	self = nil
end


}

-->8
-- selection methods

current_state_init = function(x)
	if x == 1 then 
		startup:init()
	elseif x == 2 then 
		level_1:init()
	end
end


current_state_update = function(x)
	if x == 1 then 
		startup:update()
	elseif x == 2 then 
		level_1:update()
	end
end

current_state_draw = function(x)
	if x == 1 then 
		startup:draw()
	elseif x == 2 then 
		level_1:draw()
	end
end
-->8
x = 0
y = 0
start_x = 0
start_y = 0
end_x = 128
end_y = 0
start_time = 0
duration = 2 -- seconds
animate = false
pi = 3.14159265



-- animation player between sequences

function anim_bounce()
-- suff ig
if not animate then 
	start_time = time()
	animate = true
end

elapsed = time() - start_time
t = min(elapsed/duration, 1)
	
ease = sin((t * pi) / 2); 

x = 0 + (end_x - 0) * ease
y = 0 + (end_y - 0) * ease
	if t == 1 then 
	--	animate = false
			x = end_x
			y = end_y
	end
end

-- finally player levels

level_1 = {
 

	init = function(self)	
		cls()
	end,
	
	update = function(self)
		anim_bounce()
		if self != nil then
			player:moves()
		end
	end,
	
	draw = function(self)
		cls()
		camera(x, y)
		map()
		spr(player.spr_id, player.x, player.y)
	if waiting then
		spr(bomb.spr_id, bomb.x, bomb.y)
	end
end,

}
-->8
-- collision

function collide(ob)

local x1 = ob.x/8
local y1 = ob.y/8
local x2 = (ob.x + 7)/8
local y2 = (ob.y + 7)/8

local a = fget(mget(x1,y1), 0)
local a = fget(mget(x1,y2), 0)
local a = fget(mget(x2,y1), 0)
local a = fget(mget(x2,y2), 0)

if a or b or c or d then
	return true
else 
	return false
end

end
-->8
bomb = {
	x, y = 0,
	spr_id = 15,
	exists = false,

	
	deploy = function(self)
		
		sfx(1)
	
	end
	
}
__gfx__
0000000000000000000000000000000000444400000000000999999999999000dddddddddedddddddddddddddddddddddddddddddddddddda555555900005000
0000000000096600000966000009660005555550000990000999999999999000dddddddddedddddddddddddddddddddddddddddddddddddd5dddddd4000e8800
007007000096aa600096aa600096aa6054444445009999000999999999999000dddddddddeddddddddeeeddddedededddddddddddddeeedd5dddddd400e98880
0007700000996600009966000099660054444445099999900999999999999000dddddddddeeeeddddedddedddeedededddddddddddeddddd5dddddd40e999888
0007700009111190091111900911119054444445099999900999999999990000dddddddddedddedddedddedddeddededdddeedddddeddddd5dddddd40e898888
0070070000111100001111000011110054444445099999900999999999990000dddddddddedddedddedddedddeddededdddeedddddeddddd5dddddd40e888888
0000000009000900009009000090009054444445099999900999999000000000dddddddddedddeddddeeeddddddddddddddddddddddeeedd5dddddd400e88880
0000000000000000000000000000000005555550099999900999999000000000dddddddddeeeeddddddddddddddddddddddddddddddddddd9444444a000e8800
__gff__
0000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
080808080808080808080808080808080e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e000e0000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e000e00000e0e0000000e00000e0e0e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e00000e00000e0e0e0e0e0e0000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e000e0e0e00000000000e000000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e00000e00000e0e0e0e0e000e0e0e0e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080808090a0b090c080808080808080e00000e000000000e000e000000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080808080808080d0a0b08080808080e0e000000000e000e0000000000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e00000e0e000e000e0e000e0e0e000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e000e0e0e0e0e0e0e000000000e000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e000000000e000000000e000e0e000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e0e0e0e000e000e0e0e0e00000e000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e000000000e0e0e00000000000e000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e000e0e0e0e0000000e0e0e000e000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e000000000000000e0e00000000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808080808080808080808080808080e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000202012d6502e6500f2500e2500e2500d2500b2500b2500a2500a0500a0500a050090500905009050090500a050000000000000000000000000000000000000000000000000000000000000000000000000000
